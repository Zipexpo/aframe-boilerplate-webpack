!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){window.ELEVATOR={},n(1),n(2),n(3),n(4),n(5),n(6),n(7)},function(e,t){AFRAME.registerElement("a-asset-image",{prototype:Object.create(AFRAME.ANode.prototype,{createdCallback:{value:function(){this.isAssetItem=!0}},attachedCallback:{value:function(){var e=this.getAttribute("src"),t=new THREE.ImageLoader;t.load(e,this.onImageLoaded.bind(this))}},onImageLoaded:{value:function(){AFRAME.ANode.prototype.load.call(this)}}})})},function(e,t){AFRAME.registerComponent("proxy_event",{schema:{event:{default:""},dst:{type:"selector"},bubbles:{default:!1}},init:function(){this.el.sceneEl.addEventListener(this.data.event,function(e){this.data.dst.emit(this.data.event,e,this.data.bubbles)}.bind(this))}})},function(e,t){WEATHER={CLOUDY:0,SUNNY:1,RAIN:2,SNOW:3},EVENT={NORMAL:0,FIRE:1,HURRICAN:2},ELEVATOR.currentstate={level:0,levelArr:[],time:0,weather:WEATHER.NICE,event:EVENT.NORMAL,chooseFloor:0,direction:1},TIMER={openWait:2,moving:4,keepopen:2,skipclose:-1},FLOOR={"-1":{text:"B",description:"Basement",extr:"basement: hardware storage"},0:{text:"1",description:"Ground/1st Floor",extr:"Parking lot right here"},1:{text:2,description:"Office",extr:"Department office"},2:{text:3,description:"Laboratory",extr:"Laboratory and Faculty office"}},AFRAME.registerComponent("gamestate",{schema:{level:{default:0},chooseFloor:{default:0},levelArr:{default:[]},isReachFloor:{default:!1},isOpen:{default:!1},timecounter:{default:0},state:{default:"STATE_REACH",oneOf:["STATE_MOVING","STATE_REACH","DOOR_OPENING","DOOR_CLOSING"]}},stateReach:function(e,t,n){console.log(t),null!==t&&void 0!==t&&(e.state=n?"DOOR_OPENING":e.state,e.isReachFloor=n,e.timecounter=0,document.getElementById("voice"+t).components.sound.playSound())},init:function(){function e(e,n){i.addEventListener(e,function(i){var r=n(AFRAME.utils.extend({},o),i);t(e,r)})}function t(e,t){var n=AFRAME.utils.extend({},o);i.setAttribute("gamestate",t),o=t,i.emit("gamestate-changed",{event:e,diff:AFRAME.utils.diff(n,t),state:t})}var n=this,i=this.el,r=this.initialState,o=this.data;r||(r=o),i.emit("gamestate-initialized",{state:r}),e("chosing-floor",function(e){return document.getElementById("clicksound").components.sound.playSound(),ELEVATOR.currentstate.levelArr.indexOf(ELEVATOR.currentstate.chooseFloor)!==-1&&e.level!==ELEVATOR.currentstate.chooseFloor||(ELEVATOR.currentstate.levelArr.indexOf(ELEVATOR.currentstate.chooseFloor)===-1&&ELEVATOR.currentstate.levelArr.push(ELEVATOR.currentstate.chooseFloor),1==ELEVATOR.currentstate.levelArr.length?ELEVATOR.currentstate.direction=ELEVATOR.currentstate.chooseFloor-ELEVATOR.currentstate.level>0?1:-1:ELEVATOR.currentstate.levelArr=ELEVATOR.currentstate.levelArr.filter(function(e){return ELEVATOR.currentstate.direction*(e-ELEVATOR.currentstate.level)>0||(document.querySelector("#floor_"+ELEVATOR.currentstate.chooseFloor+" .hightlight").setAttribute("visible",!1),!1)}),ELEVATOR.currentstate.levelArr=ELEVATOR.currentstate.levelArr.sort(function(e,t){return ELEVATOR.currentstate.direction*(e-t)}),"DOOR_CLOSING"!==e.state&&"STATE_REACH"!==e.state||e.level!==ELEVATOR.currentstate.chooseFloor?1==ELEVATOR.currentstate.levelArr.length&&(e.level=ELEVATOR.currentstate.level+ELEVATOR.currentstate.direction/2,e.state="STATE_MOVING"):(ELEVATOR.currentstate.levelArr.shift(),document.querySelector("#floor_"+ELEVATOR.currentstate.level+" .hightlight").setAttribute("visible",!1),e.state="DOOR_OPENING",n.stateReach(e,e.level,!0))),e}),e("set_floor",function(e){return e.level=e.level+ELEVATOR.currentstate.direction/2,ELEVATOR.currentstate.level=e.level,ELEVATOR.currentstate.levelArr.indexOf(e.level)!==-1||0===ELEVATOR.currentstate.levelArr.length&&0===ELEVATOR.currentstate.level?(ELEVATOR.currentstate.levelArr.shift(),document.querySelector("#floor_"+ELEVATOR.currentstate.level+" .hightlight").setAttribute("visible",!1),e.state="DOOR_OPENING",n.stateReach(e,e.level,!0)):(e.state="STATE_MOVING",n.stateReach(e,e.level,!1)),2===ELEVATOR.currentstate.level?ELEVATOR.currentstate.direction=-1:ELEVATOR.currentstate.level===-1&&(ELEVATOR.currentstate.direction=1),e}),e("moving",function(e){return e.level%1===0&&(e.level=ELEVATOR.currentstate.level+ELEVATOR.currentstate.direction/2),e}),e("open_door_btn",function(e){return e.isOpen&&(e.timecounter+=1e3*TIMER.keepopen),e}),e("close_door_btn",function(e){return e.isOpen&&(e.timecounter-=1e3*TIMER.skipclose),e}),e("closing_door",function(e){return"DOOR_OPENING"===e.state&&(e.timecounter=1e3*TIMER.openWait),e.state="DOOR_CLOSING",e})}}),AFRAME.registerComponent("gamestate-bind",{schema:{default:{},parse:AFRAME.utils.styleParser.parse},update:function(){var e=this.el.closestScene();e.hasLoaded&&this.updateBinders(),e.addEventListener("loaded",this.updateBinders.bind(this))},updateBinders:function(){function e(e){Object.keys(e).forEach(function(r){var o=t[r],a=e[r];i.indexOf(r)!==-1&&AFRAME.utils.entity.setComponentProperty(n,o,a)})}var t=this.data,n=this.el,i=Object.keys(this.data);n.sceneEl.addEventListener("gamestate-changed",function(t){e(t.detail.diff),(void 0!==t.detail.diff.state||void 0!==t.detail.diff.level&&t.detail.diff.level%1===0)&&stateEvent(t.detail.state,n)}),n.sceneEl.addEventListener("gamestate-initialized",function(t){e(t.detail.state)})}})},function(e,t){AFRAME.registerComponent("current-floor",{schema:{value:{default:0},color:{default:2411263}},init:function(){this.el.sceneEl.addEventListener("set_floor",function(){console.log("Here")})},update:function(){this.data.value%1===0&&this.el.setAttribute("text",{value:FLOOR[this.data.value].text})}})},function(e,t){AFRAME.registerComponent("button_floor",{schema:{value:{default:0},color:{default:2411263}},init:function(){this.clicked=!1;var e=this;this.el.addEventListener("click",function(t){ELEVATOR.currentstate.chooseFloor=e.data.value,document.querySelector("#floor_"+e.data.value+" .hightlight").setAttribute("visible",!0),e.el.emit("chosing-floor")}),this.v=!0,this.descriptonAnimation=setInterval(function(){document.querySelector("#floor_"+e.data.value+" .description").setAttribute("text",{value:FLOOR[e.data.value][e.v?"description":"extr"]}),e.v=!e.v},2e3)},update:function(){}})},function(e,t){AFRAME.registerComponent("restrict-position",{schema:{},init:function(){this.active=!AFRAME.utils.device.checkHeadsetConnected(),this.radius=2},tick:function(e,t){if(this.active){var n=new THREE.Vector3,i=this.el.object3D.position.y;n.copy(this.el.object3D.position);var r=this.radius/n.length();r<.98&&(n.multiplyScalar(this.radius/n.length()),this.el.setAttribute("position",{x:n.x,y:i,z:n.z}))}}})},function(e,t){!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerSystem("speech-command",{init:function(){this.entities=[]},registerMe:function(e){this.entities.push(e)},unregisterMe:function(e){var t=this.entities.indexOf(e);this.entities.splice(t,1)},onSceneLoaded:function(e){},play:function(){}}),AFRAME.registerComponent("speech-command",{multiple:!0,schema:{command:{type:"string"},type:{type:"string"},targetElement:{type:"selector"},targetComponent:{type:"string"},function:{type:"string"},attribute:{type:"string"},value:{type:"string"},keyCode:{type:"string"}},init:function(){this.system.registerMe(this),this.data.targetElement||(this.data.targetElement=this.el),this.data.keyCode&&window.addEventListener("keyup",this.onKeyup.bind(this))},remove:function(){this.system.unregisterMe(this)},play:function(){},executeCommand:function(){var e=this.data.targetElement;if("attribute"==this.data.type)e.setAttribute(this.data.attribute,this.data.value);else if("function"==this.data.type){var t=e.components[this.data.targetComponent];t[this.data.function]()}},onKeyup:function(e){e.keyCode==this.data.keyCode&&this.executeCommand()}}),AFRAME.registerComponent("annyang-speech-recognition",{init:function(){},play:function(){if(annyang){for(var e=document.querySelector("a-scene").systems["speech-command"],t={},n={},i=0;i<e.entities.length;i++){var r=e.entities[i];n[r.data.command]=r,t[r.data.command]=function(){}}annyang.addCommands(t),annyang.addCallback("resultMatch",function(e,t,i){var r=n[t];r.executeCommand()}),annyang.start()}}})}])}]);