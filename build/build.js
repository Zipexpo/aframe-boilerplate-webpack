!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){window.ELEVATOR={},n(1),n(2),n(3),n(4),n(5),n(6),n(7)},function(t,e){AFRAME.registerElement("a-asset-image",{prototype:Object.create(AFRAME.ANode.prototype,{createdCallback:{value:function(){this.isAssetItem=!0}},attachedCallback:{value:function(){var t=this.getAttribute("src"),e=new THREE.ImageLoader;e.load(t,this.onImageLoaded.bind(this))}},onImageLoaded:{value:function(){AFRAME.ANode.prototype.load.call(this)}}})})},function(t,e){AFRAME.registerComponent("proxy_event",{schema:{event:{default:""},dst:{type:"selector"},bubbles:{default:!1}},init:function(){this.el.sceneEl.addEventListener(this.data.event,function(t){this.data.dst.emit(this.data.event,t,this.data.bubbles)}.bind(this))}})},function(t,e){WEATHER={CLOUDY:0,SUNNY:1,RAIN:2,SNOW:3},EVENT={NORMAL:0,FIRE:1,HURRICAN:2},ELEVATOR.currentstate={level:0,levelArr:[],time:0,weather:WEATHER.NICE,event:EVENT.NORMAL,chooseFloor:0,direction:1},TIMER={openWait:2,moving:4,keepopen:2,skipclose:-1},FLOOR={"-1":{text:"B",description:"Basement",extr:"basement: hardware storage"},0:{text:"1",description:"Ground/1st Floor",extr:"Parking lot right here"},1:{text:2,description:"Office",extr:"Department office"},2:{text:3,description:"Laboratory",extr:"Laboratory and Faculty office"}},AFRAME.registerComponent("gamestate",{schema:{level:{default:0},chooseFloor:{default:0},levelArr:{default:[]},isReachFloor:{default:!1},isOpen:{default:!1},timecounter:{default:0},state:{default:"STATE_REACH",oneOf:["STATE_MOVING","STATE_REACH","DOOR_OPENING","DOOR_CLOSING"]}},stateReach:function(t,e,n){console.log(e),null!==e&&void 0!==e&&(t.state=n?"DOOR_OPENING":t.state,t.isReachFloor=n,t.timecounter=0,document.getElementById("voice"+e).components.sound.playSound())},init:function(){function t(t,n){r.addEventListener(t,function(r){var i=n(AFRAME.utils.extend({},o),r);e(t,i)})}function e(t,e){var n=AFRAME.utils.extend({},o);r.setAttribute("gamestate",e),o=e,r.emit("gamestate-changed",{event:t,diff:AFRAME.utils.diff(n,e),state:e})}var n=this,r=this.el,i=this.initialState,o=this.data;i||(i=o),r.emit("gamestate-initialized",{state:i}),t("chosing-floor",function(t){return document.getElementById("clicksound").components.sound.playSound(),ELEVATOR.currentstate.levelArr.indexOf(ELEVATOR.currentstate.chooseFloor)!==-1&&t.level!==ELEVATOR.currentstate.chooseFloor||(ELEVATOR.currentstate.levelArr.indexOf(ELEVATOR.currentstate.chooseFloor)===-1&&ELEVATOR.currentstate.levelArr.push(ELEVATOR.currentstate.chooseFloor),1==ELEVATOR.currentstate.levelArr.length?ELEVATOR.currentstate.direction=ELEVATOR.currentstate.chooseFloor-ELEVATOR.currentstate.level>0?1:-1:ELEVATOR.currentstate.levelArr=ELEVATOR.currentstate.levelArr.filter(function(t){return ELEVATOR.currentstate.direction*(t-ELEVATOR.currentstate.level)>0||(document.querySelector("#floor_"+ELEVATOR.currentstate.chooseFloor+" .hightlight").setAttribute("visible",!1),!1)}),ELEVATOR.currentstate.levelArr=ELEVATOR.currentstate.levelArr.sort(function(t,e){return ELEVATOR.currentstate.direction*(t-e)}),"DOOR_CLOSING"!==t.state&&"STATE_REACH"!==t.state||t.level!==ELEVATOR.currentstate.chooseFloor?1==ELEVATOR.currentstate.levelArr.length&&(t.level=ELEVATOR.currentstate.level+ELEVATOR.currentstate.direction/2,t.state="STATE_MOVING"):(ELEVATOR.currentstate.levelArr.shift(),document.querySelector("#floor_"+ELEVATOR.currentstate.level+" .hightlight").setAttribute("visible",!1),t.state="DOOR_OPENING",n.stateReach(t,t.level,!0))),t}),t("set_floor",function(t){return t.level=t.level+ELEVATOR.currentstate.direction/2,ELEVATOR.currentstate.level=t.level,ELEVATOR.currentstate.levelArr.indexOf(t.level)!==-1||0===ELEVATOR.currentstate.levelArr.length&&0===ELEVATOR.currentstate.level?(ELEVATOR.currentstate.levelArr.shift(),document.querySelector("#floor_"+ELEVATOR.currentstate.level+" .hightlight").setAttribute("visible",!1),t.state="DOOR_OPENING",n.stateReach(t,t.level,!0)):(t.state="STATE_MOVING",n.stateReach(t,t.level,!1)),2===ELEVATOR.currentstate.level?ELEVATOR.currentstate.direction=-1:ELEVATOR.currentstate.level===-1&&(ELEVATOR.currentstate.direction=1),t}),t("moving",function(t){return t.level%1===0&&(t.level=ELEVATOR.currentstate.level+ELEVATOR.currentstate.direction/2),t}),t("open_door_btn",function(t){return t.isOpen&&(t.timecounter+=1e3*TIMER.keepopen),t}),t("close_door_btn",function(t){return t.isOpen&&(t.timecounter-=1e3*TIMER.skipclose),t}),t("closing_door",function(t){return"DOOR_OPENING"===t.state&&(t.timecounter=1e3*TIMER.openWait),t.state="DOOR_CLOSING",t})}}),AFRAME.registerComponent("gamestate-bind",{schema:{default:{},parse:AFRAME.utils.styleParser.parse},update:function(){var t=this.el.closestScene();t.hasLoaded&&this.updateBinders(),t.addEventListener("loaded",this.updateBinders.bind(this))},updateBinders:function(){function t(t){Object.keys(t).forEach(function(i){var o=e[i],a=t[i];r.indexOf(i)!==-1&&AFRAME.utils.entity.setComponentProperty(n,o,a)})}var e=this.data,n=this.el,r=Object.keys(this.data);n.sceneEl.addEventListener("gamestate-changed",function(e){t(e.detail.diff),(void 0!==e.detail.diff.state||void 0!==e.detail.diff.level&&e.detail.diff.level%1===0)&&stateEvent(e.detail.state,n)}),n.sceneEl.addEventListener("gamestate-initialized",function(e){t(e.detail.state)})}})},function(t,e){AFRAME.registerComponent("current-floor",{schema:{value:{default:0},color:{default:2411263}},init:function(){this.el.sceneEl.addEventListener("set_floor",function(){console.log("Here")})},update:function(){if(this.data.value%1===0)this.el.setAttribute("text",{value:FLOOR[this.data.value].text}),document.querySelector("#displayFloor").setAttribute("text",{value:"Current floor: "+FLOOR[this.data.value].text});else{var t=ELEVATOR.currentstate.direction>0?Math.ceil(this.data.value):Math.floor(this.data.value);t=Math.min(Math.max(t,-1),2),document.querySelector("#displayFloor").setAttribute("text",{value:"Next floor: "+FLOOR[t].text}),document.querySelector("#videofloor").setAttribute("src","#floor_"+t+"Video"),document.querySelector("#floor_"+t+"Video").play()}}})},function(t,e){AFRAME.registerComponent("button_floor",{schema:{value:{default:0},color:{default:2411263}},init:function(){this.clicked=!1;var t=this;this.el.addEventListener("click",function(e){ELEVATOR.currentstate.chooseFloor=t.data.value,document.querySelector("#floor_"+t.data.value+" .hightlight").setAttribute("visible",!0),t.el.emit("chosing-floor")}),this.v=!0,this.descriptonAnimation=setInterval(function(){document.querySelector("#floor_"+t.data.value+" .description").setAttribute("text",{value:FLOOR[t.data.value][t.v?"description":"extr"]}),t.v=!t.v},2e3)},update:function(){}})},function(t,e){AFRAME.registerComponent("restrict-position",{schema:{},init:function(){this.active=!AFRAME.utils.device.checkHeadsetConnected(),this.radius=2},tick:function(t,e){if(this.active){var n=new THREE.Vector3,r=this.el.object3D.position.y;n.copy(this.el.object3D.position);var i=this.radius/n.length();i<.98&&(n.multiplyScalar(this.radius/n.length()),this.el.setAttribute("position",{x:n.x,y:r,z:n.z}))}}})},function(t,e){!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerSystem("speech-command",{init:function(){this.entities=[]},registerMe:function(t){this.entities.push(t)},unregisterMe:function(t){var e=this.entities.indexOf(t);this.entities.splice(e,1)},onSceneLoaded:function(t){},play:function(){}}),AFRAME.registerComponent("speech-command",{multiple:!0,schema:{command:{type:"string"},type:{type:"string"},targetElement:{type:"selector"},targetComponent:{type:"string"},function:{type:"string"},attribute:{type:"string"},value:{type:"string"},keyCode:{type:"string"}},init:function(){this.system.registerMe(this),this.data.targetElement||(this.data.targetElement=this.el),this.data.keyCode&&window.addEventListener("keyup",this.onKeyup.bind(this))},remove:function(){this.system.unregisterMe(this)},play:function(){},executeCommand:function(){var t=this.data.targetElement;if("attribute"==this.data.type)t.setAttribute(this.data.attribute,this.data.value);else if("function"==this.data.type){var e=t.components[this.data.targetComponent];e[this.data.function]()}},onKeyup:function(t){t.keyCode==this.data.keyCode&&this.executeCommand()}}),AFRAME.registerComponent("annyang-speech-recognition",{init:function(){},play:function(){if(annyang){for(var t=document.querySelector("a-scene").systems["speech-command"],e={},n={},r=0;r<t.entities.length;r++){var i=t.entities[r];n[i.data.command]=i,e[i.data.command]=function(){}}annyang.addCommands(e),annyang.addCallback("resultMatch",function(t,e,r){var i=n[e];i.executeCommand()}),annyang.start()}}})}])}]);